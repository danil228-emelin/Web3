<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui" xmlns:f="http://java.sun.com/jsf/core"
>
<h:head>
    <title>Main page</title>
    <link rel="stylesheet" href="style.css"/>

</h:head>
<h:body>
    <div class="inputs">
        <h:form id="X">
            <h:panelGrid columns="1" cellpadding="5" styleClass="ui-grid">
                <p:outputLabel for="@next" value="X"/>
                <p:spinner min="-4" max="4" id="X_INPUTS" stepFactor="0.5" value="#{value.x}"/>
            </h:panelGrid>
        </h:form>
        <h:form id="Y">
            <h:panelGrid columns="1" cellpadding="5" styleClass="ui-grid">
                <p:outputLabel for="@next" value="Y"/>
                <h:inputText id="Y_input"
                             value="#{value.y}"
                             maxlength="10"
                             required="true"
                             style="width: 245px;height: 40px"
                             title="Type a number from -3 to 5:"
                >
                    <f:validateLongRange minimum="-3" maximum="5"/>
                </h:inputText>
            </h:panelGrid>
        </h:form>
        <h:form id="R">
            <h:panelGrid columns="1" cellpadding="5" styleClass="ui-grid">
                <p:outputLabel for="@next" value="R"/>
                <p:spinner value="#{value.r}" min="0" id="R_input" max="3" stepFactor="0.1"/>
            </h:panelGrid>

        </h:form>

        <h:form id="form_send">
            <p:remoteCommand name="rc" action="#{result.test}" rendered="true"/>
            <button id="send" type="button" onclick="runRemoteCommand()">Send</button>
            <script type="text/javascript">
                function checkTime(i) {
                    if (i &lt; 10) {
                        i = "0" + i;
                    }
                    return i;
                }

                function runRemoteCommand() {
                    let d = new Date();
                    let h = d.getHours();
                    let m = checkTime(d.getMinutes());
                    let s = checkTime(d.getSeconds());
                    let mm = checkTime(d.getMilliseconds());
                    let x = document.getElementById("X:X_INPUTS_input");
                    let y = document.getElementById("Y:Y_input");
                    let r = document.getElementById("R:R_input_input");
                    var promise = rc([
                        {name: 'param1', value: x.value},
                        {name: 'param2', value: y.value},
                        {name: 'param3', value: r.value},
                        {name: 'request_time', value: h + ":" + m + ":" + s + ":" + mm}]
                    )
                    promise.then(() => {
                        window.location.reload();
                    }).catch((error) => {
                        console.error("Request failed", error);
                    });
                }
            </script>
        </h:form>


        <button id="back" type="button" onclick="changePageBack()">Back</button>
        <h:dataTable id="result" value="#{result.list}" var="list">
            <h:column>
                <f:facet name="header">X</f:facet>
                <h:outputText value="#{list.x}"/>
            </h:column>
            <h:column>
                <f:facet name="header">Y</f:facet>
                <h:outputText value="#{list.y}"/>
            </h:column>
            <h:column>
                <f:facet name="header">R</f:facet>
                <h:outputText value="#{list.r}"/>
            </h:column>
            <h:column>
                <f:facet name="header">Request Time</f:facet>
                <h:outputText value="#{list.requestTime}"/>

            </h:column>
            <h:column>
                <f:facet name="header">Response Time</f:facet>
                <h:outputText value="#{list.responseTime}"/>
            </h:column>
        </h:dataTable>
        <div id="graphic">

        </div>

    </div>

    <script type="text/javascript" src="js/graphElement.js"></script>
    <script type="text/javascript" src="js/bubble.js"></script>
    <script type="text/javascript" src="https://unpkg.com/axios/dist/axios.min.js"></script>

</h:body>
</html>